<!DOCTYPE html>
<html>
  <head>
    <title>Proytrack</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <%= stylesheet_link_tag "application" %>
    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>

  </head>

  <body class="bg-gray-100">
  <div id="flash-messages" class="fixed top-4 left-1/2 transform -translate-x-1/2 z-50 w-full max-w-md px-4">
    <% flash.each do |type, message| %>
      <% flash_class =
           case type.to_sym
           when :notice then "bg-green-100 text-green-800 border-green-300"
           when :alert then "bg-red-100 text-red-800 border-red-300"
           when :error then "bg-yellow-100 text-yellow-800 border-yellow-300"
           else "bg-gray-100 text-gray-800 border-gray-300"
           end
      %>
      <div class="flash-alert border-l-4 p-4 mb-3 rounded shadow-sm transition-opacity duration-300 opacity-100 <%= flash_class %>">
        <p class="text-sm font-medium"><%= message %></p>
      </div>
    <% end %>
  </div>


  <% if user_signed_in? %>
    <header class="bg-white shadow">
      <div class="max-w-7xl mx-auto px-4 sm:px-6">
        <!-- Header con logo, navegación y usuario en una sola línea -->
        <div class="flex flex-row justify-between items-center py-2 sm:py-4">
          <!-- Logo -->
          <%= link_to "ProyTrack", root_path, class: "text-xl sm:text-3xl font-bold text-blue-700 hover:underline" %>

          <!-- Navegación, Usuario y Cerrar Sesión -->
          <div class="flex items-center space-x-2 sm:space-x-4">
            <!-- Navegación -->
            <nav class="flex">
              <ul class="flex space-x-2">
                <li>
                  <%= link_to root_path, class: "inline-flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-md transition-colors #{current_page?(root_path) ? 'bg-blue-100 text-blue-700' : 'text-gray-700 hover:bg-gray-100'}" do %>
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path>
                    </svg>
                    <span>Proyectos</span>
                  <% end %>
                </li>
                <li>
                  <%= link_to settlements_path, class: "inline-flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-md transition-colors #{request.path.start_with?('/settlements') ? 'bg-purple-100 text-purple-700' : 'text-gray-700 hover:bg-gray-100'}" do %>
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span>Liquidaciones</span>
                  <% end %>
                </li>
              </ul>
            </nav>

            <!-- Usuario -->
            <span class="flex items-center space-x-2 text-xs sm:text-sm text-gray-700">
              <svg class="w-4 h-4 sm:w-5 sm:h-5 text-blue-600" fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" d="M5.121 17.804A7 7 0 0112 15a7 7 0 016.879 2.804M15 10a3 3 0 11-6 0 3 3 0 016 0z" />
              </svg>
              <span class="hidden lg:inline">Hola, <span class="font-medium text-gray-900"><%= current_user.email %></span></span>
            </span>

            <!-- Cerrar Sesión -->
            <%= button_to "Cerrar sesión", destroy_user_session_path,
                          method: :delete,
                          class: "text-white bg-blue-600 hover:bg-blue-700 text-sm font-medium px-3 py-1 rounded transition-colors whitespace-nowrap",
                          form_class: "inline" %>
          </div>
        </div>
      </div>
    </header>

  <% end %>
  <main>
    <%= yield %>
  </main>
  </body>
</html>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const alerts = document.querySelectorAll(".flash-alert");
        alerts.forEach(alert => {
            setTimeout(() => {
                alert.classList.add("opacity-0");
                setTimeout(() => alert.remove(), 500);
            }, 6000); // Oculta después de 6 segundos
        });
    });
</script>
